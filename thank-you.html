<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="images/favicon.png">
  <title>Thank You | The Chic Artist</title>

  
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville&family=Inter:wght@300;400&display=swap" rel="stylesheet">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
    <!-- Flatpickr datepicker (allows click-to-open) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>

<header class="site-header">
  <div class="container header-inner">

    <!-- Brand / Logo -->
    <div class="brand">
      <a href="index.html" class="logo-link" data-scroll="top">
        <img src="images/logo.png" alt="The Chic Artist Logo" class="logo">
      </a>
    </div>

    <!-- Desktop Nav -->
    <nav class="main-nav d-flex justify-content-center">
      <a href="index.html">Home</a>
      <a href="wedding.html">Wedding</a>
      <a href="bookmarks.html">Bookmarks</a>
      <a href="cards.html">Paintings</a>
      <a href="OnlineClass.html">OnlineClass</a>
      <a href="ebooks.html">E-Books</a>
      <a href="index.html#contact">Contact</a>
    </nav>

    <!-- Social Icons + Cart -->
    <div class="header-right d-flex align-items-center">
      <div class="social-icons d-flex">
        <a href="https://www.instagram.com/the.chic.artist" target="_blank"><img src="images/icons/instagram.svg"></a>
        <a href="https://www.youtube.com/@TheChicArtist" target="_blank"><img src="images/icons/youtube.svg"></a>
        <a href="https://www.facebook.com/neetikaag" target="_blank"><img src="images/icons/facebook.svg"></a>
        <a href="https://www.tiktok.com/@the.chic.artist" target="_blank"><img src="images/icons/tiktok.svg"></a>
        <a href="https://thechicartiststudio.etsy.com" target="_blank"><img src="images/icons/etsy.svg"></a>
      </div>

      <!-- Cart Icon -->
      <div class="cart-wrapper position-relative ms-3">
        <img src="images/icons/cart.svg" id="cartIcon" style="width:28px; cursor:pointer;">
        <span id="cartCount" style="top:-5px; right:-5px; font-size:0.7rem;">0</span>
      </div>

      <!-- Mobile Hamburger -->
      <div class="mobile-menu-icon ms-3" onclick="toggleMobileMenu()">‚ò∞</div>
    </div>

  </div>
</header>

<!-- Mobile Side Console -->
<div id="mobileSideConsole" class="mobile-side-console">
  <ul>
    <li><a href="index.html" data-scroll="top">Home</a></li>
    <li><a href="wedding.html">Wedding</a></li>
    <li><a href="bookmarks.html">Bookmarks</a></li>
    <li><a href="cards.html">Paintings</a></li>
    <li><a href="OnlineClass.html">OnlineClass</a></li>
    <li><a href="ebooks.html">E-Books</a></li>
    <li><a href="index.html#contact">Contact</a></li>
  </ul>
</div>

<!-- Overlay -->
<div id="mobileMenuOverlay" class="mobile-menu-overlay"></div>


<main class="container thank-you-page" style="max-width:700px; margin:60px auto; text-align:center;">
  <h1>Thank you for your order ‚ú®</h1>
  <p>Your payment was successful.</p>

  <div id="orderSummary" style="margin-top:30px; text-align:left;"></div>

  <p style="margin-top:40px;">
    You‚Äôll receive a confirmation email shortly.<br>
    If you have questions, feel free to contact me.
  </p>

  <a href="index.html" class="btn btn-dark mt-4">Back to Home</a>
</main>

<footer class="py-4 text-center text-muted position-relative">
  ¬© 2026 The Chic Artist<br>
  <a href="terms-and-conditions.html" style="color:#888; text-decoration:underline; font-size:0.85rem;">Terms &amp; Conditions</a>

  <!-- FAQ Toggle -->
  <div id="footerFaqToggle" 
       style="position:absolute; right:40px; top:50%; transform:translateY(-50%); cursor:pointer; font-weight:500; color:#555;">
    FAQ &#x25B2; <!-- small triangle as icon -->
  </div>

  <!-- Footer FAQ panel -->
  <div id="footerFaqPanel" 
       style="position:absolute; right:20px; bottom:50px; width:300px; max-height:0; overflow:hidden; background:#fff; box-shadow:0 4px 10px rgba(0,0,0,0.1); border-radius:8px; transition:max-height 0.4s ease;">
    <div style="padding:1rem; font-size:0.9rem; color:#333;">
      <p><strong>Where do you ship?</strong><br>We currently ship within Canada & USA. For other countries, <a href="index.html#contact">contact us</a> or order via <a href="https://thechicartiststudio.etsy.com" target="_blank">Etsy</a>.</p>
      <p><strong>Does shipping include tracking?</strong><br>USA orders include tracking; Canadian Lettermail does not.</p>
      <p><strong>Do you accept returns/exchanges?</strong><br>All items are custom-made. Returns/exchanges are not offered.</p>
      <p><strong>Custom pieces?</strong><br>Contact us via the <a href="index.html#contact">form</a> to create your unique design.</p>
    </div>
  </div>
</footer>

<script>
  const faqToggle = document.getElementById('footerFaqToggle');
  const faqPanel = document.getElementById('footerFaqPanel');
  let faqOpen = false;

  faqToggle.addEventListener('click', () => {
    faqOpen = !faqOpen;
    if (faqOpen) {
      faqPanel.style.maxHeight = faqPanel.scrollHeight + 'px';
      faqToggle.innerHTML = 'FAQ &#x25BC;'; // down arrow
    } else {
      faqPanel.style.maxHeight = '0';
      faqToggle.innerHTML = 'FAQ &#x25B2;'; // up arrow
    }
  });
   // Optional: close FAQ when clicking outside
  document.addEventListener('click', (e) => {
    if (faqOpen && !faqPanel.contains(e.target) && e.target !== faqToggle) {
      faqPanel.style.maxHeight = '0';
      faqToggle.innerHTML = 'FAQ &#x25B2;';
      faqOpen = false;
    }
  });
</script>


<script>
  // ================================================================
  // GOOGLE FORM CONFIG
  // Replace GOOGLE_FORM_ACTION_URL with your Google Form action URL
  // Replace each entry.XXXXXXXXX with your actual field IDs
  // (Share your pre-filled link and I'll fill these in for you)
  // ================================================================
  const GOOGLE_FORM_ACTION_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSdacPH7Ei3oTkc5v6_25VLsqsxN6BGaLkQQ8WS3uopsFO0aQw/formResponse';
  const FORM_FIELDS = {
    name:     'entry.1443252762',
    email:    'entry.135636391',
    items:    'entry.151631524',
    total:    'entry.1798209524',
    shipping: 'entry.1779461501',
    tax:      'entry.179704303',
    province: 'entry.69235671',
    country:  'entry.1320686186',
    zip:      'entry.829073282',
    address:  'entry.186903765',
  };

  async function sendOrderEmail(order) {
    try {
      // Recover address details saved by cart.js before Stripe redirect
      let pendingAddress = {};
      try { pendingAddress = JSON.parse(sessionStorage.getItem('pendingOrderAddress') || '{}'); } catch {}
      sessionStorage.removeItem('pendingOrderAddress');

      const body = new FormData();
      body.append(FORM_FIELDS.name,     pendingAddress.name     || order.payerName || order.payerEmail?.split('@')[0] || 'Customer');
      body.append(FORM_FIELDS.email,    pendingAddress.email    || order.payerEmail  || '');
      body.append(FORM_FIELDS.items,    (order.items || []).map(i => `${i.name} ($${Number(i.price).toFixed(2)})`).join(', '));
      body.append(FORM_FIELDS.total,    `${order.total} ${order.currency || ''}`);
      body.append(FORM_FIELDS.shipping, order.shipping    || '');
      body.append(FORM_FIELDS.tax,      order.tax         || '');
      body.append(FORM_FIELDS.province, pendingAddress.province || order.province    || '');
      body.append(FORM_FIELDS.country,  pendingAddress.country  || order.country     || '');
      body.append(FORM_FIELDS.zip,      pendingAddress.zip      || order.zip         || '');
      body.append(FORM_FIELDS.address,  pendingAddress.address  || '');

      // Google Forms blocks CORS but the submission still goes through
      await fetch(GOOGLE_FORM_ACTION_URL, {
        method: 'POST',
        mode: 'no-cors',
        body
      });
      console.log('Order notification sent via Google Form');
    } catch (err) {
      console.warn('Could not send Google Form notification:', err);
    }
  }

  // Try sessionStorage first (local testing), then fall back to URL params (live Stripe redirect)
  let order = null;

  const stored = sessionStorage.getItem('lastOrder');
  if (stored) {
    try { order = JSON.parse(stored); } catch {}
    sessionStorage.removeItem('lastOrder');
  }

  // If not in sessionStorage, read from URL params (set by Stripe success_url)
  if (!order) {
    const params = new URLSearchParams(window.location.search);
    const raw = params.get('order');
    if (raw) {
      try { order = JSON.parse(decodeURIComponent(raw)); } catch {}
    }
  }

  if (!order) {
    // No order data at all ‚Äî redirect home
    window.location.href = 'index.html';
  } else {
    // Show order summary
    const itemsHtml = (order.items || [])
      .map(i => `
        <li style="display:flex; align-items:center; margin-bottom:10px;">
          <img src="${i.image || ''}" alt="${i.name}" style="width:60px; height:auto; margin-right:10px; border-radius:4px;">
          <span>${i.name} ‚Äî $${Number(i.price).toFixed(2)}</span>
        </li>
      `)
      .join('');

    document.getElementById('orderSummary').innerHTML = `
      <h3>Order Summary</h3>
      <ul style="list-style:none; padding-left:0;">${itemsHtml}</ul>
      <p><strong>Shipping:</strong> $${order.shipping}</p>
      <p><strong>Tax:</strong> $${order.tax}</p>
      <p><strong>Total Paid:</strong> $${order.total} ${order.currency || ''}</p>
    `;

    // Clear cart now that payment is confirmed
    localStorage.removeItem('cart');

    // Show ebook download buttons if present
    if (order.ebookDownloads && order.ebookDownloads.length > 0) {
      const dlSection = document.createElement('div');
      dlSection.style.cssText = 'margin-top:28px; padding:24px; background:#faf9f7; border:1px solid #ece8e1; border-radius:14px; text-align:left;';
      dlSection.innerHTML = `
        <p style="font-family:'Libre Baskerville',serif; font-style:italic; font-size:1rem; margin-bottom:16px; color:#2c2c2c;">
          üì• Your download${order.ebookDownloads.length > 1 ? 's are' : ' is'} ready:
        </p>
        ${order.ebookDownloads.map(d => `
          <a href="${d.url}" download
             style="display:flex; align-items:center; gap:12px; padding:12px 18px; margin-bottom:10px;
                    background:#fff; border:1px solid #ece8e1; border-radius:10px; text-decoration:none;
                    color:#2c2c2c; font-family:'Inter',sans-serif; font-size:0.88rem;
                    transition:box-shadow 0.2s ease;"
             onmouseover="this.style.boxShadow='0 4px 16px rgba(0,0,0,0.08)'"
             onmouseout="this.style.boxShadow='none'">
            <span style="font-size:1.4rem;">üìÑ</span>
            <span style="flex:1;">${d.title}</span>
            <span style="color:#b09a82; font-size:0.8rem; letter-spacing:0.05em;">DOWNLOAD PDF ‚Üí</span>
          </a>
        `).join('')}
        <p style="font-family:'Inter',sans-serif; font-size:0.75rem; color:#aaa; margin-top:12px; margin-bottom:0;">
          ‚è± Links expire in 24 hours. A copy has also been sent to your email.
        </p>
      `;
      document.getElementById('orderSummary').appendChild(dlSection);
    }

    // Email is handled by Worker only on successful payment
    // Trigger a separate call to send the email now that we know payment succeeded
    if (order.ebookDownloads && order.ebookDownloads.length > 0) {
      fetch('https://stripe-worker.thechicartiststudio.workers.dev/send-ebook-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: order.payerEmail,
          name: order.payerName,
          downloads: order.ebookDownloads
        })
      });
    }

    // Send order notification email via Google Form
    sendOrderEmail(order);


  }
</script>

<script>
function toggleMobileMenu() {
  const menu = document.getElementById('mobileSideConsole');
  const overlay = document.getElementById('mobileMenuOverlay');
  menu.classList.toggle('active');
  overlay.classList.toggle('active');
}

// Close menu when overlay is clicked
document.getElementById('mobileMenuOverlay').addEventListener('click', toggleMobileMenu);

// Close menu when a link inside is clicked
document.querySelectorAll('#mobileSideConsole a').forEach(link => {
  link.addEventListener('click', () => {
    const menu = document.getElementById('mobileSideConsole');
    const overlay = document.getElementById('mobileMenuOverlay');
    menu.classList.remove('active');
    overlay.classList.remove('active');
  });
});

</script>

</body>
</html>